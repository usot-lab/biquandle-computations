import numpy as np
import itertools
from dataclasses import dataclass

@dataclass
class ParsedCode:
    label: str
    pCode: list
    signs: list
    index: int
    
def parse_labeled_code(label, raw_code):
    left, right = raw_code.strip().split('/')
    signs = right.strip().split()
    tokens = left[1:-1].split()
    pCode = []
    index = -1
    for i, token in enumerate(tokens):
        if token.endswith('^'):
            index = i
            token = token[:-1]
        pCode.append(int(token))

    return ParsedCode(label=label, pCode=pCode, signs=signs, index=index)

labeled_raw_codesV = [
    ("2.1.1","[-5 -9^ -7 -1 -3]/+ + * * +"),
    ("2.1.2","[5 7 1 9 3^]/- + * + -"),
    ("3.1.1","[-5 -9^ -7 -1 -3]/+ + * + +"),
    ("3.1.2","[-7 -5 -9^ -1 -3]/+ * + + +"),
    ("3.1.3","[-7 -5 -9^ -1 -3]/+ * + + -"),
    ("3.1.4","[-5 -9^ -7 -1 -3]/+ + * + -"),
    ("3.1.5","[-3 -7 -9^ -1 -5]/+ * + + +"),
    ("3.1.6","[-3 -7 -9^ -1 -5]/+ * + + -"),
    ("3.1.7","[-3 -7 -9^ -1 -5]/+ * + - +"),
    ("3.1.8","[-5 -7 -9^ -1 -3]/+ + + * +"),
    ("3.1.9","[5 -9 -7 11^ -3 -1]/+ * * + + +"),
    ("3.1.10","[5 -9 -7 11^ -3 -1]/- * * + + +"),
    ("3.1.11","[-3 7 -9 -11^ 1 -5]/+ * * + + +"),
    ("3.1.12","[-3 7 -9 -11^ 1 -5]/+ * * + + -"),
    ("4.1.1","[-3 -11^ -1 -9 -5 -7]/+ + + * + +"),
    ("4.1.2","[-9 -5 -1 -3 -11^ -7]/- * + + + + "),
    ("4.1.3","[-9 -5 -1 -3 -11^ -7]/- * + + + -"),
    ("4.1.4","[-3 7 -11^ -9 1 -5]/+ + + * + +"),
    ("4.1.5","[5 -9 -7 11^ -3 -1]/+ + * + + +"),
    ("4.1.6","[5 -9 -7 11^ -3 -1]/- + * + + +"),
    ("4.1.7","[-3 7 -11^ -9 1 -5]/+ * + + + +"),
    ("4.1.8","[-3 7 -11^ -9 1 -5]/+ * + + - +"),
    ("4.1.9","[-5 7 -11^ -9 1 -3]/+ + + * + + "),
    ("4.1.10","[-7 -5 9 -11^ -1 3]/- * + + - + "),
    ("4.1.11","[-3 7 -9 -11^ 1 -5]/+ * + + + +"),
    ("4.1.12","[-3 7 -9 -11^ 1 -5]/+ * + + - +"),
    ("4.1.13","[-7 -5 9 -11^ -1 3]/- + * + - +"),
    ("4.1.14","[-7 -5 9 -11^ -1 3]/- + * + - -"),
    ("4.1.15","[-3 7 -9 -11^ 1 -5]/+ + * + + +"),
    ("5.1.1","[-3 5 -13^ 1 -11 -7 -9]/+ + + + * + +"),
    ("5.1.2","[3 -11 13^ -9 -5 -7 -1]/+ + + * + + +"),
    ("5.1.3","[-3 -13^ -1 -9 11 -5 7]/+ + + * + + +"),
    ("5.1.4","[9 -5 -1 -3 -11 13^ -7]/+ + + + * + +"),
    ("5.1.5","[9 -5 -1 -3 -11 13^ -7]/- + + + * + +"),
    ("5.1.6","[9 -5 -1 -3 -11 13^ -7]/+ + + + * + -"),
    ("5.1.7","[9 -5 -1 -3 -11 13^ -7]/- + + + * + -"),
    ("5.1.8","[-3 -13^ -1 -9 11 -5 7]/+ + + * - - -"),
    ("5.1.9","[-11 -5 7 -1 3 -13^ -9]/- * + + + + +"),
    ("5.1.10","[5 9 13^ 3 -11 1 -7]/+ + + + * + +"),
    ("5.1.11","[7 11 1 -9 13^ -5 3]/+ + + * + + +"),
    ("5.1.12","[9 13^ -7 11 -3 1 5]/+ + * + + + +"),
    ("5.1.13","[5 9 13^ 3 -11 1 -7]/+ + + - * + +"),
    ("5.1.14","[11 -5 9 -1 13^ 3 7]/+ * + + + + -"),
    ("5.1.15","[11 -5 9 -1 13^ 3 7]/- * + + + + -")
]
parsed_codesV = [parse_labeled_code(label, line) for label, line in labeled_raw_codesV]
vknotoid_codes = {pc.label: pc for pc in parsed_codesV}

### Biquandle Virtual Bracket Storage
class MyVbracket:
    def __init__(self, b_p, bvb_p, u_matrix, o_matrix, A, B, V, C, D, U, delta, omega):
        self.bp = b_p
        self.bvbp = bvb_p
        self.under = u_matrix
        self.over = o_matrix
        self.A = A
        self.B = B
        self.V = V
        self.C = C
        self.D = D
        self.U = U
        self.delta = delta
        self.omega = omega
###
b_p0 = 2
bvb_p0 = 5
u_matrix0=[[1,1],[0,0]]
o_matrix0=[[1,1],[0,0]]
A0=[[1,1],[1,1]]
B0=[[1,1],[1,1]]
V0=[[0,3],[2,0]]
C0=[[1,3],[3,1]]
D0=[[1,3],[3,1]]
U0=[[0,1],[4,0]]
delta0 = 3
omega0 = 4
###
b_p1 = 3
bvb_p1 = 3
u_matrix1=[[2,2,2],[0,0,0],[1,1,1]]
o_matrix1=[[2,2,2],[0,0,0],[1,1,1]]
A1=[[1,1,1],[2,1,1],[2,2,1]]
B1=[[2,2,2],[1,2,2],[1,1,2]]
V1=[[0,0,0],[0,0,0],[0,0,0]]
C1=[[1,1,1],[2,1,1],[2,2,1]]
D1=[[2,2,2],[1,2,2],[1,1,2]]
U1=[[0,0,0],[0,0,0],[0,0,0]]
delta1 = 2
omega1 = 1
###
b_p2 = 3
bvb_p2 = 5
u_matrix2 = [[1,1,1],[0,0,0],[2,2,2]]
o_matrix2 = [[1,1,1],[0,0,0],[2,2,2]]
A2=[[4,0,0],[0,4,0],[0,0,4]]
B2=[[1,0,0],[0,1,0],[0,0,1]]
V2=[[0,2,3],[2,0,2],[1,4,0]]
C2=A2
D2=B2
U2=[[0,3,2],[3,0,3],[1,4,0]]
delta2=2
omega2=4
###
b_p3 = 2
bvb_p3 = 7
u_matrix3 = [[0,0],[1,1]]
o_matrix3 = [[0,0],[1,1]]
A3=[[1,0],[0,1]]
B3=[[6,0],[0,6]]
V3=[[0,4],[5,0]]
C3=A3
D3=B3
U3=[[0,2],[3,0]]
delta3=2
omega3=1
###
b_p4 = 3
bvb_p4 = 7
u_matrix4 = [[1, 1, 1],[2, 2, 2],[0, 0, 0]]
o_matrix4 = [[1, 1, 1],[2, 2, 2],[0, 0, 0]]
A4=[[5,0,0],[0,5,0],[0,0,5]]
B4=[[2,0,0],[0,2,0],[0,0,2]]
V4=[[0,6,5],[6,0,4],[3,2,0]]
C4=[[3,0,0],[0,3,0],[0,0,3]]
D4=[[4,0,0],[0,4,0],[0,0,4]]
U4=[[0,6,3],[6,0,2],[5,4,0]]
delta4=2
omega4=5
###
b_p5 = 3
bvb_p5 = 7
u_matrix5 = [[1, 1, 1],[2, 2, 2],[0, 0, 0]]
o_matrix5 = [[1, 1, 1],[2, 2, 2],[0, 0, 0]]
A5=[[4,0,0],[0,4,0],[0,0,4]]
B5=[[3,0,0],[0,3,0],[0,0,3]]
V5=[[0,6,5],[6,0,4],[3,2,0]]
C5=[[2,0,0],[0,2,0],[0,0,2]]
D5=[[5,0,0],[0,5,0],[0,0,5]]
U5=[[0,6,3],[6,0,2],[5,4,0]]
delta5=2
omega5=4
###
b_p6 = 3
bvb_p6 = 11
u_matrix6 = [[1, 1, 1],[2, 2, 2],[0, 0, 0]]
o_matrix6 = [[1, 1, 1],[2, 2, 2],[0, 0, 0]]
A6=[[5,0,0],[0,5,0],[0,0,5]]
B6=[[3,0,0],[0,3,0],[0,0,3]]
V6=[[0,1,2],[5,0,6],[8,10,0]]
C6=[[9,0,0],[0,9,0],[0,0,9]]
D6=[[4,0,0],[0,4,0],[0,0,4]]
U6=[[0,1,6],[9,0,2],[7,10,0]]
delta6=8
omega6=10
###
b_p7 = 3
bvb_p7 = 37
u_matrix7 = [[1, 1, 1],[2, 2, 2],[0, 0, 0]]
o_matrix7 = [[1, 1, 1],[2, 2, 2],[0, 0, 0]]
A7=[[7,0,0],[0,7,0],[0,0,7]]
B7=[[11,0,0],[0,11,0],[0,0,11]]
V7=[[0,2,8],[24,0,25],[6,33,0]]
C7=[[16,0,0],[0,16,0],[0,0,16]]
D7=[[27,0,0],[0,27,0],[0,0,27]]
U7=[[0,19,14],[17,0,3],[31,9,0]]
delta7=5
omega7=9
###
b_p8 = 3
bvb_p8 = 11
u_matrix8=[[2,1,0],[1,0,2],[0,2,1]]
o_matrix8=[[2,2,2],[0,0,0],[1,1,1]]
A8=[[3,5,10],[8,3,4],[3,9,3]]
B8=[[8, 6, 1], [3, 8, 7], [8, 2, 8]]
V8=[[0,0,0],[0,0,0],[0,0,0]]
C8=[[4,9,10],[7,4,3],[4,5,4]]
D8=[[7,2,1],[4,7,8],[7,6,7]]
U8=[[0,0,0],[0,0,0],[0,0,0]]
delta8=2
omega8=3

b_p9 = 3
bvb_p9 = 11
u_matrix9=[[2,1,0],[1,0,2],[0,2,1]]
o_matrix9=[[2,2,2],[0,0,0],[1,1,1]]
A9=[[7,2,4],[1,7,7],[8,6,7]]
B9=[[4, 9, 7], [10, 4, 4], [3, 5, 4]]
V9=[[0,0,0],[0,0,0],[0,0,0]]
C9=[[8,6,3],[1,8,8],[7,2,8]]
D9=[[3,5,8],[10,3,3],[4,9,3]]
U9=[[0,0,0],[0,0,0],[0,0,0]]
delta9=2
omega9=7

b_p10 = 3
bvb_p10 = 7
u_matrix10=[[0,1,2],[1,2,0],[2,0,1]]
o_matrix10=[[0,0,0],[2,2,2],[1,1,1]]
A10=[[1,1,6],[2,1,2],[4,3,1]]
B10=[[3,3,4],[6,3,6],[5,2,3]]
V10=[[0,0,0],[0,0,0],[0,0,0]]
C10=[[1,1,6],[4,1,4],[2,5,1]]
D10=[[5,5,2],[6,5,6],[3,4,5]]
U10=[[0,0,0],[0,0,0],[0,0,0]]
delta10=6
omega10=2

b_p11 = 3
bvb_p11 = 11
u_matrix11=[[0,1,2],[1,2,0],[2,0,1]]
o_matrix11=[[0,0,0],[2,2,2],[1,1,1]]
A11=[[3,1,10],[3,3,9],[3,2,3]]
B11=[[8, 10, 1], [8, 8, 2], [8, 9, 8]]
V11=[[0,0,0],[0,0,0],[0,0,0]]
C11=[[4,1,10],[4,4,5],[4,6,4]]
D11=[[7,10,1],[7,7,6],[7,5,7]]
U11=[[0,0,0],[0,0,0],[0,0,0]]
delta11=2
omega11=3

b_p12 = 3
bvb_p12 = 7
u_matrix12=[[0,1,2],[1,2,0],[2,0,1]]
o_matrix12=[[0,0,0],[2,2,2],[1,1,1]]
A12=[[3,2,5],[5,3,4],[6,5,3]]
B12=[[4, 5, 2], [2, 4, 3], [1, 2, 4]]
V12=[[0,0,0],[0,0,0],[0,0,0]]
C12=[[5,4,3],[3,5,2],[6,3,5]]
D12=[[2,3,4],[4,2,5],[1,4,2]]
U12=[[0,0,0],[0,0,0],[0,0,0]]
delta12=2
omega12=3

b_p13 = 3
bvb_p13 = 13
u_matrix13=[[0,1,2],[1,2,0],[2,0,1]]
o_matrix13=[[0,0,0],[2,2,2],[1,1,1]]
A13=[[3,11,8],[9,3,6],[1,2,3]]
B13=[[10, 2, 5], [4, 10, 7], [12, 11, 10]]
V13=[[0,0,0],[0,0,0],[0,0,0]]
C13=[[9,6,5],[3,9,11],[1,7,9]]
D13=[[4,7,8],[10,4,2],[12,6,4]]
U13=[[0,0,0],[0,0,0],[0,0,0]]
delta13=2
omega13=3

b_p14 = 3
bvb_p14 = 13
u_matrix14=[[0,1,2],[1,2,0],[2,0,1]]
o_matrix14=[[0,0,0],[2,2,2],[1,1,1]]
A14=[[6,3,2],[2,6,4],[5,2,6]]
B14=[[7, 10, 11], [11, 7, 9], [8, 11, 7]]
V14=[[0,0,0],[0,0,0],[0,0,0]]
C14=[[11,9,7],[7,11,10],[8,7,11]]
D14=[[2,4,6],[6,2,3],[5,6,2]]
U14=[[0,0,0],[0,0,0],[0,0,0]]
delta14=2
omega14=6

b_p15 = 3
bvb_p15 = 17
u_matrix15=[[0,1,2],[1,2,0],[2,0,1]]
o_matrix15=[[0,0,0],[2,2,2],[1,1,1]]
A15=[[4,11,12],[4,4,3],[4,7,4]]
B15=[[13, 6, 5], [13, 13, 14], [13, 10, 13]]
V15=[[0,0,0],[0,0,0],[0,0,0]]
C15=[[13,14,10],[13,13,6],[13,5,13]]
D15=[[4,3,7],[4,4,11],[4,12,4]]
U15=[[0,0,0],[0,0,0],[0,0,0]]
delta15=2
omega15=4

b_p16 = 3
bvb_p16 = 7
u_matrix16=[[0,1,2],[1,2,0],[2,0,1]]
o_matrix16=[[0,0,0],[2,2,2],[1,1,1]]
A16=[[3,3,1],[5,3,5],[6,4,3]]
B16=[[4, 4, 6], [2, 4, 2], [1, 3, 4]]
V16=[[0,0,0],[0,0,0],[0,0,0]]
C16=[[5,5,1],[3,5,3],[6,2,5]]
D16=[[2,2,6],[4,2,4],[1,5,2]]
U16=[[0,0,0],[0,0,0],[0,0,0]]
delta16=2
omega16=3

b_p17 = 3
bvb_p17 = 7
u_matrix17=[[0,1,2],[1,2,0],[2,0,1]]
o_matrix17=[[0,0,0],[2,2,2],[1,1,1]]
A17=[[3,5,4],[6,3,5],[5,2,3]]
B17=[[2, 1, 5], [4, 2, 1], [1, 6, 2]]
V17=[[0,0,0],[0,0,0],[0,0,0]]
C17=[[5,3,2],[6,5,3],[3,4,5]]
D17=[[4,1,3],[2,4,1],[1,6,4]]
U17=[[0,0,0],[0,0,0],[0,0,0]]
delta17=6
omega17=6

bvb = [MyVbracket(b_p0, bvb_p0, u_matrix0, o_matrix0, A0, B0, V0, C0, D0, U0, delta0, omega0),\
                             MyVbracket(b_p1, bvb_p1, u_matrix1, o_matrix1, A1, B1, V1, C1, D1, U1, delta1, omega1),\
      MyVbracket(b_p2, bvb_p2, u_matrix2, o_matrix2, A2, B2, V2, C2, D2, U2, delta2, omega2),\
      MyVbracket(b_p3, bvb_p3, u_matrix3, o_matrix3, A3, B3, V3, C3, D3, U3, delta3, omega3),\
      MyVbracket(b_p4, bvb_p4, u_matrix4, o_matrix4, A4, B4, V4, C4, D4, U4, delta4, omega4),\
      MyVbracket(b_p5, bvb_p5, u_matrix5, o_matrix5, A5, B5, V5, C5, D5, U5, delta5, omega5),\
      MyVbracket(b_p6, bvb_p6, u_matrix6, o_matrix6, A6, B6, V6, C6, D6, U6, delta6, omega6),\
      MyVbracket(b_p7, bvb_p7, u_matrix7, o_matrix7, A7, B7, V7, C7, D7, U7, delta7, omega7),\
      MyVbracket(b_p8, bvb_p8, u_matrix8, o_matrix8, A8, B8, V8, C8, D8, U8, delta8, omega8),\
      MyVbracket(b_p9, bvb_p9, u_matrix9, o_matrix9, A9, B9, V9, C9, D9, U9, delta9, omega9),\
      MyVbracket(b_p10, bvb_p10, u_matrix10, o_matrix10, A10, B10, V10, C10, D10, U10, delta10, omega10),\
      MyVbracket(b_p11, bvb_p11, u_matrix11, o_matrix11, A11, B11, V11, C11, D11, U11, delta11, omega11),\
      MyVbracket(b_p12, bvb_p12, u_matrix12, o_matrix12, A12, B12, V12, C12, D12, U12, delta12, omega12),\
      MyVbracket(b_p13, bvb_p13, u_matrix13, o_matrix13, A13, B13, V13, C13, D13, U13, delta13, omega13),\
      MyVbracket(b_p14, bvb_p14, u_matrix14, o_matrix14, A14, B14, V14, C14, D14, U14, delta14, omega14),\
      MyVbracket(b_p15, bvb_p15, u_matrix15, o_matrix15, A15, B15, V15, C15, D15, U15, delta15, omega15),\
      MyVbracket(b_p16, bvb_p16, u_matrix16, o_matrix16, A16, B16, V16, C16, D16, U16, delta16, omega16),\
      MyVbracket(b_p17, bvb_p17, u_matrix17, o_matrix17, A17, B17, V17, C17, D17, U17, delta17, omega17)]
bqVirtual_brackets = {f"VB{i}": obj for i, obj in enumerate(bvb)}

# Biquandle Storage

# Random, under 2(x+y)+1, over x+1.
p0=3
u_matrix0=[[1,0,2],[0,2,1],[2,1,0]]
o_matrix0=[[1,1,1],[2,2,2],[0,0,0]]

# Random, ....
p1=5
u_matrix1=[[2,0,2,0,0],[4,3,4,1,4],[0,2,0,2,2],[1,1,1,4,3],[3,4,3,3,1]] 
o_matrix1=[[2,2,2,2,2],[4,3,4,3,3],[0,0,0,0,0],[1,4,1,4,4],[3,1,3,1,1]]

# Alexander, p=5, t=2, r=3.
p2=5
u_matrix2=[[0,1,2,3,4],[2,3,4,0,1],[4,0,1,2,3],[1,2,3,4,0],[3,4,0,1,2]]
o_matrix2=[[0,0,0,0,0],[3,3,3,3,3],[1,1,1,1,1],[4,4,4,4,4],[2,2,2,2,2]]

# Alexander, p=3, t=1, r=2.
p3=3
u_matrix3=[[0, 1, 2],[1, 2, 0],[2, 0, 1]]
o_matrix3=[[0, 0, 0],[2, 2, 2],[1, 1, 1]]

# Random, under 2(x+y)+1, over 4x+1.
p4=5
u_matrix4=[[1,3,0,2,4],[3,0,2,4,1],[0,2,4,1,3],[2,4,1,3,0],[4,1,3,0,2]]
o_matrix4=[[1,1,1,1,1],[0,0,0,0,0],[4,4,4,4,4],[3,3,3,3,3],[2,2,2,2,2]]

# Random, under x+y+1, over 2x+1
p5=3
u_matrix5=[[1,2,0],[2,0,1],[0,1,2]]
o_matrix5=[[1,1,1],[0,0,0],[2,2,2]]

# Random, under 2(x+y)+2, over x+2
p6=3
u_matrix6=[[2,1,0],[1,0,2],[0,2,1]]
o_matrix6=[[2,2,2],[0,0,0],[1,1,1]]

# Alexander, p=5, t=2, r=4
p7=5
u_matrix7=[[0,2,4,1,3],[2,4,1,3,0],[4,1,3,0,2],[1,3,0,2,4],[3,0,2,4,1]]
o_matrix7=[[0,0,0,0,0],[4,4,4,4,4],[3,3,3,3,3],[2,2,2,2,2],[1,1,1,1,1]]

# Alexander, p=3, t=2, r=1.
p8=3
u_matrix8=[[1, 1, 1],[2, 2, 2],[0, 0, 0]]
o_matrix8=[[1, 1, 1],[2, 2, 2],[0, 0, 0]]

# Symmetric
p9=3
u_matrix9=[[0, 2, 0],[1, 1, 1],[2, 0, 2]]
o_matrix9=[[0, 2, 0],[1, 1, 1],[2, 0, 2]]

# Symmetric
p10=2
u_matrix10=[[1,1],[0,0]]
o_matrix10=[[1,1],[0,0]]

# Symmetric
p11=3
u_matrix11=[[1,1,1],[0,0,0],[2,2,2]]
o_matrix11=[[1,1,1],[0,0,0],[2,2,2]]

class MyObject:
    def __init__(self, p, u_matrix, o_matrix):
        self.p = p
        self.under = u_matrix
        self.over = o_matrix

bq_list = [MyObject(p0,u_matrix0,o_matrix0), MyObject(p1,u_matrix1,o_matrix1), \
           MyObject(p2,u_matrix2,o_matrix2),MyObject(p3,u_matrix3,o_matrix3),\
           MyObject(p4,u_matrix4,o_matrix4),MyObject(p5,u_matrix5,o_matrix5),\
           MyObject(p6,u_matrix6,o_matrix6),MyObject(p7,u_matrix7,o_matrix7),\
           MyObject(p8,u_matrix8,o_matrix8),MyObject(p9,u_matrix9,o_matrix9),\
          MyObject(p10,u_matrix10,o_matrix10),MyObject(p11,u_matrix11,o_matrix11)]
biquandles = {f"{i}": obj for i, obj in enumerate(bq_list)}
